<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>T-PACHIN · 機台頁面 - 最後10分鐘警示</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Russo+One&display=swap" rel="stylesheet">
    <style>
        /* ===== 基礎科技風格 ===== */
        .tech-gradient {
            background: linear-gradient(180deg, #000814 0%, #001233 50%, #001845 100%);
        }
        
        .tech-border {
            border: 1px solid rgba(0, 148, 255, 0.4);
        }
        
        /* ===== 導航列 ===== */
        .bottom-nav {
            background: #001a33;
            border-top: 2px solid #0066cc;
            box-shadow: 0 -2px 10px rgba(0, 102, 204, 0.3);
            width: 100%;
            max-width: 448px;
            padding: 0.75rem 1.5rem;
            margin-top: 1rem;
            z-index: 50;
        }
        
        .nav-item {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #4b9cd3;
            transition: all 0.2s ease;
            border-radius: 8px;
            padding: 0.25rem 0.5rem;
            text-decoration: none;
            outline: none;
        }
        
        .nav-item:hover {
            color: #80e4ff;
            transform: translateY(-2px);
            text-shadow: 0 0 6px #00ccff;
            background: rgba(0, 153, 255, 0.15);
        }
        
        .nav-item:active {
            transform: scale(0.95);
            color: white;
            background: rgba(0, 204, 255, 0.3);
        }
        
        .nav-item.current-page {
            color: white;
            background: linear-gradient(90deg, #0066cc 0%, #0099ff 100%);
            border: 1px solid #80e4ff;
            box-shadow: 0 0 12px #00ccff;
            transform: scale(1.02);
        }
        
        /* ===== Logo 樣式 ===== */
        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Orbitron', 'Russo One', sans-serif;
            white-space: nowrap;
            cursor: pointer;
            transition: transform 0.2s ease;
            text-decoration: none;
            color: inherit;
        }

        .logo:active {
            transform: scale(0.97);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #000, #111, #222);
            border-radius: 8px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 15px rgba(0, 224, 255, 0.5), inset 0 0 10px rgba(255, 215, 0, 0.2);
            overflow: hidden;
            border: 2px solid #ffd700;
            flex-shrink: 0;
        }

        .logo-icon::before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: conic-gradient(from 0deg, transparent, #00e0ff, #c90a0a, #ffd700, transparent);
            animation: logoRotate 4s linear infinite;
        }

        .logo-icon::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            background: #000;
            border-radius: 5px;
        }

        @keyframes logoRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .logo-icon-inner {
            position: relative;
            z-index: 2;
            font-size: 16px;
            font-weight: 900;
            background: linear-gradient(45deg, #ffdf00, #ffec8b, #00e0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-main {
            font-size: 18px;
            font-weight: 900;
            background: linear-gradient(45deg, #ffdf00, #ffd700, #00e0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-sub {
            font-size: 9px;
            color: #00e0ff;
        }
        
        /* ===== 分類標籤 ===== */
        .category-tabs-container {
            display: flex;
            justify-content: center;
            gap: 1rem;
            padding: 0.5rem 0;
            width: 100%;
        }
        
        .category-tab {
            background: rgba(0, 40, 70, 0.6);
            border: 1px solid rgba(0, 153, 255, 0.3);
            border-radius: 9999px;
            padding: 0.6rem 1.8rem;
            font-size: 0.95rem;
            color: #cce6ff;
            transition: all 0.2s;
            cursor: pointer;
            white-space: nowrap;
            flex: 0 1 auto;
            min-width: 100px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .category-tab.active {
            background: linear-gradient(90deg, #0066cc, #0099ff);
            color: white;
            border-color: #80e4ff;
            box-shadow: 0 0 15px #00ccff;
        }
        
        /* ===== 橫式卡片新布局 ===== */
        .horizontal-card {
            background: linear-gradient(180deg, rgba(0, 40, 80, 0.9) 0%, rgba(0, 20, 40, 0.95) 100%);
            border: 1px solid rgba(0, 153, 255, 0.3);
            border-radius: 1rem;
            overflow: hidden;
            transition: all 0.2s ease;
            margin-bottom: 1rem;
            padding: 1rem;
            position: relative;
        }
        
        .horizontal-card:hover {
            border-color: #0099ff;
            box-shadow: 0 4px 15px rgba(0, 153, 255, 0.3);
        }
        
        /* 上層：圖片 + 基本資訊 */
        .card-top {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .card-image {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 0.75rem;
            border: 1px solid rgba(0, 153, 255, 0.3);
            flex-shrink: 0;
        }
        
        .card-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .card-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: #80e4ff;
            text-shadow: 0 0 5px #00ccff;
        }
        
        .info-tags {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .info-tag {
            background: rgba(0, 50, 100, 0.8);
            border: 1px solid rgba(0, 153, 255, 0.3);
            border-radius: 9999px;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            color: #cce6ff;
        }
        
        .token-badge {
            background: linear-gradient(135deg, #fbbf24, #d97706);
            color: #000;
            font-weight: bold;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            border: 1px solid #f59e0b;
            box-shadow: 0 0 8px rgba(245, 158, 11, 0.5);
        }
        
        .card-stats-mini {
            display: flex;
            gap: 1rem;
            font-size: 0.7rem;
            color: #b0d4ff;
            margin-top: 0.2rem;
        }
        
        /* 倒數計時器 */
        .countdown-timer {
            font-size: 14px;
            font-weight: 700;
            color: #ffaa00;
            text-shadow: 0 0 5px #ff9900;
        }
        
        .countdown-timer.urgent {
            color: #ff3333;
            text-shadow: 0 0 8px #ff0000;
            animation: blink 1s infinite;
        }
        
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* ===== 雙頁面板 - 所有人都可以點擊切換 ===== */
        .pachinko-panel {
            background: linear-gradient(180deg, #0a1a2a 0%, #051016 100%);
            border: 2px solid #00e0ff;
            border-radius: 12px;
            padding: 15px;
            margin: 0.5rem 0 1rem 0;
            box-shadow: 0 0 20px rgba(0, 224, 255, 0.3), inset 0 0 10px rgba(0, 224, 255, 0.2);
            font-family: 'Orbitron', monospace;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .pachinko-panel:active {
            transform: scale(0.99);
            border-color: #ffd700;
        }
        
        .panel-pages {
            position: relative;
            min-height: 170px;
        }
        
        .panel-page {
            transition: opacity 0.2s ease;
        }
        
        .panel-page.hidden {
            display: none;
        }
        
        /* ===== 第1頁：今日數據 ===== */
        .page1-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #00e0ff;
            padding-bottom: 8px;
            margin-bottom: 10px;
        }
        
        .page1-title {
            font-size: 18px;
            font-weight: 900;
            color: #ffd700;
            text-shadow: 0 0 8px #ffd700;
            letter-spacing: 2px;
        }
        
        /* 天井顯示樣式 */
        .tenjo-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tenjo-badge {
            background: linear-gradient(90deg, #ff9900, #ff5500);
            color: white;
            font-size: 12px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 20px;
            border: 1px solid #ffaa00;
            box-shadow: 0 0 10px #ff9900;
            letter-spacing: 0.5px;
        }
        
        .data-row-header {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
            font-size: 10px;
            color: #ffd700;
            text-align: center;
            margin-bottom: 6px;
        }
        
        .data-row-values {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 4px;
            margin-bottom: 12px;
        }
        
        .data-cell {
            background: #000;
            border: 1px solid #00e0ff;
            border-radius: 4px;
            padding: 8px 2px;
            text-align: center;
            font-size: 16px;
            font-weight: 900;
            color: #00e0ff;
            text-shadow: 0 0 5px #00e0ff;
        }
        
        /* ===== 第2頁：雙排數據條（紅綠大賞燈） ===== */
        .page2-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #00e0ff;
            padding-bottom: 8px;
            margin-bottom: 15px;
        }
        
        .page2-title {
            font-size: 18px;
            font-weight: 900;
            color: #ffd700;
            text-shadow: 0 0 8px #ffd700;
        }
        
        /* 上排：天數 */
        .days-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 0 5px;
        }
        
        .day-item {
            width: 28px;
            text-align: center;
            font-size: 14px;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 5px #ffd700;
        }
        
        /* 數據條區域 */
        .bars-container {
            display: flex;
            gap: 3px;
            margin-bottom: 10px;
            height: 70px;
            align-items: flex-end;
        }
        
        .bar-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            height: 100%;
        }
        
        .bar-grid {
            width: 100%;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #00e0ff;
            border-radius: 4px;
            padding: 3px;
            display: flex;
            flex-direction: column-reverse;
            gap: 2px;
            height: 100%;
        }
        
        .bar-segment {
            width: 100%;
            height: 10px;
            background: rgba(0, 224, 255, 0.2);
            border-radius: 2px;
            transition: all 0.3s ease;
        }
        
        /* 紅色填充 - 代表大當/大獎 */
        .bar-segment.filled-red {
            background: linear-gradient(90deg, #ff3333, #cc0000);
            box-shadow: 0 0 8px #ff0000;
        }
        
        /* 綠色填充 - 代表連莊/RUSH */
        .bar-segment.filled-green {
            background: linear-gradient(90deg, #33cc33, #008800);
            box-shadow: 0 0 8px #00ff00;
        }
        
        .values-row {
            display: flex;
            justify-content: space-between;
            padding: 0 5px;
            margin-top: 8px;
        }
        
        .value-item {
            width: 28px;
            text-align: center;
            font-size: 11px;
            font-weight: 700;
            color: #00e0ff;
            text-shadow: 0 0 5px #00e0ff;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 4px;
            padding: 3px 0;
        }
        
        .page-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
        }
        
        .indicator-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(0, 224, 255, 0.3);
            border: 1px solid #00e0ff;
            transition: all 0.2s ease;
        }
        
        .indicator-dot.active {
            background: #00e0ff;
            box-shadow: 0 0 12px #00e0ff;
            transform: scale(1.3);
        }
        
        .card-actions {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .enter-btn {
            transition: all 0.2s ease;
            background: linear-gradient(90deg, rgba(0, 102, 204, 0.2), rgba(0, 153, 255, 0.2));
            border: 1px solid rgba(0, 153, 255, 0.5);
            padding: 0.6rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 0.9rem;
            color: #cce6ff;
            flex: 1;
            cursor: pointer;
        }
        
        .enter-btn.available {
            background: linear-gradient(90deg, #10b981, #059669);
            border-color: #34d399;
            color: white;
        }
        
        .enter-btn.reserved {
            background: linear-gradient(90deg, #f59e0b, #d97706);
            border-color: #fbbf24;
            color: white;
        }
        
        .leave-btn {
            transition: all 0.2s ease;
            background: linear-gradient(90deg, #ef4444, #b91c1c);
            border: 1px solid #f87171;
            padding: 0.6rem 1.5rem;
            border-radius: 0.75rem;
            font-size: 0.9rem;
            color: white;
            flex: 1;
            cursor: pointer;
        }
        
        .leave-btn:hover {
            background: linear-gradient(90deg, #dc2626, #991b1b);
            box-shadow: 0 0 15px #ef4444;
        }
        
        .favorite-btn {
            transition: all 0.2s ease;
            cursor: pointer;
            background: rgba(0, 30, 60, 0.6);
            border: 1px solid rgba(0, 148, 255, 0.5);
            width: 42px;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem;
            flex-shrink: 0;
        }
        
        .favorite-btn.active {
            background: rgba(255, 105, 180, 0.25) !important;
            border-color: #ff69b4 !important;
            box-shadow: 0 0 15px #ff1493;
        }
        
        .favorite-btn.active i {
            color: #ff69b4 !important;
            font-size: 1.2rem;
        }
        
        .favorite-btn.inactive i {
            color: #9ca3af !important;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            border-bottom: 1px solid rgba(0, 153, 255, 0.3);
            padding-bottom: 0.5rem;
        }
        
        .section-title {
            font-size: 1.1rem;
            color: #80e4ff;
        }
        
        .section-count {
            font-size: 0.9rem;
            color: #b0d4ff;
            background: rgba(0, 153, 255, 0.2);
            padding: 0.2rem 0.8rem;
            border-radius: 30px;
        }
        
        /* ===== 彈跳紅色警示小視窗 ===== */
        .alert-popup {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #ff0000, #990000);
            color: white;
            padding: 16px 20px;
            border-radius: 16px;
            border: 2px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 15px;
            min-width: 280px;
            max-width: 90%;
            animation: slideDown 0.3s ease;
            cursor: grab;
            touch-action: none;
            transition: transform 0.1s ease;
            pointer-events: auto;
            user-select: none;
            will-change: transform, opacity;
        }
        
        .alert-popup.swiping {
            transition: none;
            cursor: grabbing;
        }
        
        @keyframes slideDown {
            from {
                top: -100px;
                opacity: 0;
            }
            to {
                top: 20px;
                opacity: 1;
            }
        }
        
        .alert-popup .alert-icon {
            font-size: 28px;
            animation: pulse 1.5s infinite;
            flex-shrink: 0;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .alert-popup .alert-content {
            flex: 1;
        }
        
        .alert-popup .alert-title {
            font-size: 18px;
            font-weight: 900;
            margin-bottom: 4px;
            text-shadow: 0 0 10px #ffd700;
        }
        
        .alert-popup .alert-message {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* ===== 離開確認視窗 ===== */
        .confirm-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.2s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .confirm-content {
            background: linear-gradient(135deg, #1a1a1a, #000);
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 24px;
            max-width: 320px;
            width: 90%;
            text-align: center;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.3);
            animation: scaleIn 0.3s ease;
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .confirm-content .icon {
            font-size: 48px;
            color: #ffd700;
            margin-bottom: 16px;
            animation: warningPulse 1.5s infinite;
        }
        
        @keyframes warningPulse {
            0% { transform: scale(1); text-shadow: 0 0 20px #ffd700; }
            50% { transform: scale(1.1); text-shadow: 0 0 40px #ffd700; }
            100% { transform: scale(1); text-shadow: 0 0 20px #ffd700; }
        }
        
        .confirm-content h3 {
            font-size: 24px;
            font-weight: 900;
            color: #ffd700;
            margin-bottom: 12px;
            text-shadow: 0 0 10px #ffd700;
        }
        
        .confirm-content p {
            color: #fff;
            margin-bottom: 24px;
            font-size: 16px;
            line-height: 1.5;
        }
        
        .confirm-content .machine-name {
            color: #00e0ff;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 8px;
        }
        
        .confirm-buttons {
            display: flex;
            gap: 12px;
        }
        
        .confirm-btn {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            font-weight: 700;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }
        
        .confirm-btn.cancel {
            background: linear-gradient(135deg, #666, #333);
            color: white;
        }
        
        .confirm-btn.cancel:hover {
            background: linear-gradient(135deg, #777, #444);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
        }
        
        .confirm-btn.confirm {
            background: linear-gradient(135deg, #ff4444, #cc0000);
            color: white;
            border: 1px solid #ffd700;
        }
        
        .confirm-btn.confirm:hover {
            background: linear-gradient(135deg, #ff6666, #ee0000);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 0, 0, 0.5);
        }
        
        .hidden {
            display: none !important;
        }
        
        .main-content {
            flex: 1;
            padding-bottom: 80px;
        }
        
        /* 防止頁面在滑動警示時滾動 */
        body.alert-active {
            overflow: hidden;
        }

        /* ===== 炫光全像投影 Loading 動畫 (從 index.html 移植) ===== */
        .hologram-loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(10px);
            z-index: 999999;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .hologram-loading.show {
            opacity: 1;
            visibility: visible;
        }

        .hologram-content {
            text-align: center;
            position: relative;
            transform: scale(0.8);
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .hologram-loading.show .hologram-content {
            transform: scale(1);
        }

        .hologram-circle {
            width: 120px;
            height: 120px;
            margin: 0 auto 30px;
            position: relative;
            border-radius: 50%;
            background: linear-gradient(45deg, #00ccff, #0066cc, #00ccff);
            background-size: 200% 200%;
            animation: hologram-gradient 3s ease infinite;
            box-shadow: 
                0 0 30px rgba(0, 204, 255, 0.5),
                inset 0 0 30px rgba(0, 204, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .hologram-inner-circle {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: #000;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0, 204, 255, 0.5);
        }

        .hologram-inner-circle::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(
                from 0deg,
                transparent,
                #00ccff,
                #ffd700,
                #00ccff,
                transparent
            );
            animation: hologram-rotate 3s linear infinite;
        }

        .hologram-scan-line {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent, 
                #00ccff, 
                #ffffff, 
                #00ccff, 
                transparent
            );
            box-shadow: 0 0 20px #00ccff;
            animation: scan-move 2s ease-in-out infinite;
            opacity: 0.8;
        }

        .hologram-scan-line.delay {
            animation: scan-move 2s ease-in-out infinite 1s;
            top: auto;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent, 
                #ffd700, 
                #ffffff, 
                #ffd700, 
                transparent
            );
        }

        .hologram-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(0,204,255,0.3) 0%, transparent 70%);
            animation: pulse-glow 2s ease-in-out infinite;
        }

        .hologram-text {
            margin: 20px 0 10px;
            font-family: 'Orbitron', sans-serif;
            font-size: 24px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: #00ccff;
            text-shadow: 
                0 0 10px #00ccff,
                0 0 20px #0066cc,
                0 0 40px #00ccff;
            animation: text-flicker 3s linear infinite;
        }

        .glitch-text {
            position: relative;
            display: inline-block;
        }

        .glitch-text::before,
        .glitch-text::after {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
        }

        .glitch-text::before {
            animation: glitch-1 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite;
            color: #ff00ff;
            z-index: -1;
        }

        .glitch-text::after {
            animation: glitch-2 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) infinite reverse;
            color: #00ffff;
            z-index: -2;
        }

        .hologram-subtext {
            font-size: 18px;
            color: #90d0ff;
            letter-spacing: 2px;
            text-transform: uppercase;
            opacity: 0.8;
            animation: fade-pulse 2s ease-in-out infinite;
            margin-top: 5px;
        }

        .hologram-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #00ccff;
            border-radius: 50%;
            box-shadow: 0 0 10px #00ccff;
            animation: particle-float 3s linear infinite;
        }

        .particle:nth-child(1) { top: 20%; left: 30%; animation-delay: 0s; }
        .particle:nth-child(2) { top: 60%; left: 70%; animation-delay: 0.5s; }
        .particle:nth-child(3) { top: 80%; left: 40%; animation-delay: 1s; }
        .particle:nth-child(4) { top: 30%; left: 80%; animation-delay: 1.5s; }
        .particle:nth-child(5) { top: 70%; left: 20%; animation-delay: 2s; }

        @keyframes hologram-gradient {
            0% { background-position: 0% 0%; }
            50% { background-position: 100% 100%; }
            100% { background-position: 0% 0%; }
        }

        @keyframes hologram-rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes scan-move {
            0% { transform: translateY(-60px); opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(60px); opacity: 0; }
        }

        @keyframes pulse-glow {
            0%, 100% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.8; transform: translate(-50%, -50%) scale(1.2); }
        }

        @keyframes text-flicker {
            0%, 100% { opacity: 1; text-shadow: 0 0 10px #00ccff, 0 0 20px #0066cc, 0 0 40px #00ccff; }
            33% { opacity: 0.9; text-shadow: 0 0 15px #00ccff, 0 0 30px #0066cc, 0 0 60px #00ccff; }
            66% { opacity: 1; text-shadow: 0 0 8px #00ccff, 0 0 15px #0066cc, 0 0 30px #00ccff; }
        }

        @keyframes glitch-1 {
            0%, 100% { clip-path: inset(0 0 0 0); transform: translate(0); }
            10% { clip-path: inset(2% 0 5% 0); transform: translate(-2px, 2px); }
            20% { clip-path: inset(10% 0 20% 0); transform: translate(2px, -2px); }
            30% { clip-path: inset(50% 0 30% 0); transform: translate(-2px); }
            40% { clip-path: inset(20% 0 60% 0); transform: translate(2px); }
            50% { clip-path: inset(70% 0 10% 0); transform: translate(-2px, 2px); }
            60% { clip-path: inset(80% 0 5% 0); transform: translate(2px, -2px); }
        }

        @keyframes glitch-2 {
            0%, 100% { clip-path: inset(0 0 0 0); transform: translate(0); }
            10% { clip-path: inset(5% 0 10% 0); transform: translate(2px, -2px); }
            20% { clip-path: inset(30% 0 40% 0); transform: translate(-2px, 2px); }
            30% { clip-path: inset(60% 0 20% 0); transform: translate(2px); }
            40% { clip-path: inset(40% 0 30% 0); transform: translate(-2px); }
            50% { clip-path: inset(20% 0 50% 0); transform: translate(2px, -2px); }
            60% { clip-path: inset(10% 0 70% 0); transform: translate(-2px, 2px); }
        }

        @keyframes fade-pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        @keyframes particle-float {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0); opacity: 0; }
        }

        /* ===== 公告按鈕框樣式 (從 index.html 移植) ===== */
        .announcement-combo {
            background: linear-gradient(145deg, #001f3f, #001a33);
            border: 1px solid #0099ff80;
            border-radius: 9999px;
            box-shadow: 0 0 20px rgba(0, 153, 255, 0.4);
            backdrop-filter: blur(2px);
            padding: 0.25rem 0.25rem 0.25rem 0.75rem;
            display: inline-flex;
            align-items: center;
            width: 100%;
            position: relative;
            overflow: hidden;
            min-height: 42px;
        }
        .announcement-combo .hologram-lines {
            position: absolute;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            border-radius: 9999px;
        }
        .announcement-combo .hologram-lines div {
            width: 100%;
            height: 1px;
            background: rgba(0, 204, 255, 0.25);
            position: absolute;
            left: 0;
        }
        .combo-announce-btn {
            background: linear-gradient(145deg, #0066cc, #0099ff);
            border: 1px solid #80e4ff;
            border-radius: 9999px;
            padding: 0.25rem 1rem;
            font-weight: 700;
            font-size: 0.85rem;
            box-shadow: 0 0 12px #00ccff;
            transition: 0.2s;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: white;
            text-decoration: none;
            letter-spacing: 0.3px;
            margin-right: 10px;
            flex-shrink: 0;
            z-index: 2;
        }
        .combo-announce-btn:hover {
            transform: scale(1.02);
            background: linear-gradient(145deg, #0077dd, #00aaff);
            border-color: white;
            box-shadow: 0 0 20px #00ccff;
        }
        .combo-announce-btn:active { transform: scale(0.96); }
        
        .combo-marquee {
            flex: 1;
            min-width: 0;
            white-space: nowrap;
            overflow: hidden;
            color: #b3e6ff;
            font-weight: 700;
            font-size: 0.85rem;
            letter-spacing: 0.5px;
            text-shadow: 0 0 6px #0099ff;
            padding-right: 0.5rem;
            z-index: 2;
        }
        .combo-marquee marquee {
            width: 100%;
            display: inline-block;
        }

        .animate-scan-line {
            animation: scan-line 3s ease-in-out infinite;
        }
        .animate-scan-line-delay {
            animation: scan-line 3s ease-in-out infinite 1.5s;
        }
        @keyframes scan-line {
            0% { transform: translateY(-20px); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateY(20px); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 to-blue-950 text-white">

<div class="max-w-md mx-auto tech-gradient min-h-screen flex flex-col">
    
    <!-- 頂部導航 -->
    <header class="px-4 py-3 bg-dark-200/90 tech-border">
        <div class="flex items-center justify-between">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <div class="logo-icon-inner">TP</div>
                </div>
                <div class="logo-text">
                    <div class="logo-main">T-PACHIN</div>
                    <div class="logo-sub">CYBER PACHINKO SYSTEM</div>
                </div>
            </a>
            
            <div class="flex flex-col items-end">
                <div class="text-xs text-white">夫人會生氣</div>
                <div class="font-bold text-lg text-yellow-400">5,280</div>
            </div>
        </div>
    </header>

    <!-- 公告按鈕框 (與 index.html 完全相同) -->
    <div class="px-4 mt-2">
        <div class="announcement-combo">
            <div class="hologram-lines">
                <div class="animate-scan-line" style="top: 20%;"></div>
                <div class="animate-scan-line-delay" style="top: 60%;"></div>
            </div>
            <a href="news.html" class="combo-announce-btn">
                <i class="fa fa-bullhorn"></i>
                <span>公告</span>
            </a>
            <div class="combo-marquee">
                <marquee scrollamount="5" behavior="scroll" direction="left">◈ 春 季 人 氣 機 台 大 賞 ◈ 甲 賀 忍 法 帖 系 列 全 線 熱 賣 ◈ 代 幣 優 惠 實 施 中 ◈</marquee>
            </div>
        </div>
    </div>

    <!-- 分類標籤 -->
    <div class="px-4 py-4">
        <div class="category-tabs-container">
            <button class="category-tab active" data-tab="favorite">
                <i class="fa fa-heart text-pink-400"></i>我的最愛
            </button>
            <button class="category-tab" data-tab="reserve">
                <i class="fa fa-clock-o text-yellow-400"></i>保留中
            </button>
        </div>
    </div>

    <!-- 主要內容 -->
    <main class="flex-1 px-4 overflow-y-auto main-content pb-4">
        <!-- 我的最愛區塊 -->
        <div id="favorite-section" class="category-section">
            <div class="section-header">
                <h2 class="section-title"><i class="fa fa-heart text-pink-400"></i> 我的最愛</h2>
                <span class="section-count" id="favoriteCount">0 台</span>
            </div>
            <div id="favoriteContainer"></div>
            <div id="noFavoriteMsg" class="text-center py-12 text-gray-400">
                <i class="fa fa-heart-o text-5xl mb-3 opacity-50"></i>
                <p class="text-lg">尚未加入任何最愛</p>
            </div>
        </div>

        <!-- 保留中區塊 -->
        <div id="reserve-section" class="category-section hidden">
            <div class="section-header">
                <h2 class="section-title"><i class="fa fa-clock-o text-yellow-400"></i> 保留中機台</h2>
                <span class="section-count" id="reserveCount">0 台</span>
            </div>
            <div id="reserveContainer"></div>
            <div id="noReserveMsg" class="text-center py-12 text-gray-400">
                <i class="fa fa-clock-o text-5xl mb-3 opacity-50"></i>
                <p class="text-lg">目前沒有保留中機台</p>
            </div>
        </div>
    </main>

    <!-- 彈跳警示容器 -->
    <div id="alertContainer"></div>
    
    <!-- 離開確認容器 -->
    <div id="confirmContainer"></div>

    <!-- 炫光全像投影 Loading 動畫容器 -->
    <div class="hologram-loading" id="hologramLoading">
        <div class="hologram-content">
            <div class="hologram-circle">
                <div class="hologram-inner-circle"></div>
                <div class="hologram-scan-line"></div>
                <div class="hologram-scan-line delay"></div>
                <div class="hologram-glow"></div>
            </div>
            <div class="hologram-text">
                <span class="glitch-text" data-text="LOADING">LOADING</span>
            </div>
            <div class="hologram-subtext">載入中......</div>
            <div class="hologram-particles">
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
                <div class="particle"></div>
            </div>
        </div>
    </div>

    <!-- 底部导航 -->
    <nav class="bottom-nav mx-auto">
        <div class="flex justify-between items-center">
            <a href="index.html" class="nav-item" id="nav-home">
                <i class="fa fa-home text-xl"></i>
                <span class="text-xs mt-1">首頁</span>
            </a>
            <a href="machines.html" class="nav-item current-page" id="nav-game">
                <i class="fa fa-gamepad text-xl"></i>
                <span class="text-xs mt-1">機台</span>
            </a>
            <a href="news.html" class="nav-item" id="nav-bell">
                <i class="fa fa-bell text-xl"></i>
                <span class="text-xs mt-1">公告</span>
            </a>
            <a href="about.html" class="nav-item" id="nav-user">
                <i class="fa fa-user text-xl"></i>
                <span class="text-xs mt-1">我的</span>
            </a>
        </div>
    </nav>

    <script>
        // ==================== 我的最愛連動功能 ====================
        const FAVORITE_STORAGE_KEY = 't Pachin_favoriteMachines';
        
        // 從 localStorage 載入我的最愛
        function loadFavoritesFromStorage() {
            const stored = localStorage.getItem(FAVORITE_STORAGE_KEY);
            if (stored) {
                try {
                    return JSON.parse(stored);
                } catch (e) {
                    console.error('解析我的最愛失敗', e);
                    return [];
                }
            }
            return [];
        }

        // 儲存我的最愛到 localStorage
        function saveFavoritesToStorage(favorites) {
            localStorage.setItem(FAVORITE_STORAGE_KEY, JSON.stringify(favorites));
        }

        // ==================== 資料庫 ====================
        const machineDatabase = [
            { id:1, name:'甲賀忍法帖 弐', image:'https://static.wixstatic.com/media/d5e540_e7da9c3f1fb24a2aa9ef8d180a2cf6fa~mv2.png', ratio:'1枚=2', vendor:'Sammy' },
            { id:2, name:'超級奇蹟小丑', image:'https://static.wixstatic.com/media/d5e540_1c6cd7d36cc24e47a6b359a1abeb3923~mv2.png', ratio:'1枚=1', vendor:'Olympia' },
            { id:3, name:'吉宗', image:'https://static.wixstatic.com/media/d5e540_0926089e3da443eebe6bc2ede58f5788~mv2.png', ratio:'1枚=2', vendor:'Daito' },
            { id:4, name:'北斗神拳', image:'https://static.wixstatic.com/media/d5e540_e7da9c3f1fb24a2aa9ef8d180a2cf6fa~mv2.png', ratio:'1枚=3', vendor:'Sammy' },
            { id:5, name:'海物語', image:'https://static.wixstatic.com/media/d5e540_1c6cd7d36cc24e47a6b359a1abeb3923~mv2.png', ratio:'1枚=1', vendor:'Olympia' }
        ];

        // ==================== 狀態資料 ====================
        // 我的最愛 - 從 localStorage 讀取
        let favoriteMachines = loadFavoritesFromStorage();
        
        // 如果沒有資料，加入測試資料
        if (favoriteMachines.length === 0) {
            favoriteMachines = [machineDatabase[0], machineDatabase[1], machineDatabase[2]];
            saveFavoritesToStorage(favoriteMachines);
        }
        
        // 保留中機台 - 設定不同的保留時間
        const now = Date.now();
        let reserveMachines = [
            { 
                ...machineDatabase[3], 
                reserveTime: '15:30', 
                expiresAt: now + 9 * 60 * 1000, // 9分鐘後（已進入最後10分鐘）
                lastAlertTime: 0
            },
            { 
                ...machineDatabase[4], 
                reserveTime: '16:00', 
                expiresAt: now + 25 * 60 * 1000, // 25分鐘後
                lastAlertTime: 0
            },
            { 
                ...machineDatabase[0], 
                reserveTime: '16:30', 
                expiresAt: now + 40 * 60 * 1000, // 40分鐘後
                lastAlertTime: 0
            }
        ];

        // ==================== 產生紅綠大賞燈 ====================
        function generateBarSegments(value, maxValue = 150) {
            const filledCount = Math.ceil((value / maxValue) * 5);
            let segments = '';
            
            for (let i = 0; i < 5; i++) {
                if (i < filledCount) {
                    if (i <= 1) {
                        segments += `<div class="bar-segment filled-green"></div>`;
                    } else {
                        segments += `<div class="bar-segment filled-red"></div>`;
                    }
                } else {
                    segments += `<div class="bar-segment"></div>`;
                }
            }
            
            return segments;
        }

        // ==================== 建立雙頁面板 ====================
        function createPachinkoPanel(machineId) {
            const panelId = `panel-${machineId}`;
            
            const days = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
            const values = [49, 127, 77, 136, 95, 148, 58, 114, 93, 149];
            const maxValue = 150;
            
            const todayData = {
                bb: Math.floor(Math.random() * 8) + 1,
                rb: Math.floor(Math.random() * 5) + 1,
                totalSpins: Math.floor(Math.random() * 300) + 50,
                currentSpins: Math.floor(Math.random() * 150) + 30,
                maxTokens: (Math.floor(Math.random() * 50) + 10) * 100
            };
            
            let barsHtml = '';
            for (let i = 0; i < days.length; i++) {
                barsHtml += `
                    <div class="bar-wrapper">
                        <div class="bar-grid">
                            ${generateBarSegments(values[i], maxValue)}
                        </div>
                    </div>
                `;
            }
            
            let daysHtml = '';
            for (let i = 0; i < days.length; i++) {
                daysHtml += `<span class="day-item">${days[i]}</span>`;
            }
            
            let valuesHtml = '';
            for (let i = 0; i < values.length; i++) {
                valuesHtml += `<span class="value-item">${values[i]}</span>`;
            }
            
            return `
                <div class="pachinko-panel" id="${panelId}" data-page="1">
                    <div class="panel-pages">
                        <div class="panel-page" id="${panelId}-page1">
                            <div class="page1-header">
                                <div class="tenjo-display">
                                    <span class="page1-title">今日</span>
                                    <span class="tenjo-badge">天井:1,980</span>
                                </div>
                                <span style="font-size:12px; color:#00e0ff;">TODAY</span>
                            </div>
                            
                            <div class="data-row-header">
                                <span>BB</span>
                                <span>RB</span>
                                <span>總轉數</span>
                                <span>目前轉數</span>
                                <span>最高枚數</span>
                            </div>
                            
                            <div class="data-row-values">
                                <div class="data-cell">${todayData.bb}</div>
                                <div class="data-cell">${todayData.rb}</div>
                                <div class="data-cell">${todayData.totalSpins}</div>
                                <div class="data-cell">${todayData.currentSpins}</div>
                                <div class="data-cell">${todayData.maxTokens.toLocaleString()}</div>
                            </div>
                        </div>
                        
                        <div class="panel-page hidden" id="${panelId}-page2">
                            <div class="page2-header">
                                <span class="page2-title">大賞燈</span>
                            </div>
                            
                            <div class="days-row">
                                ${daysHtml}
                            </div>
                            
                            <div class="bars-container">
                                ${barsHtml}
                            </div>
                            
                            <div class="values-row">
                                ${valuesHtml}
                            </div>
                        </div>
                    </div>
                    
                    <div class="page-indicator">
                        <span class="indicator-dot active" data-panel="${panelId}" data-page="1"></span>
                        <span class="indicator-dot" data-panel="${panelId}" data-page="2"></span>
                    </div>
                </div>
            `;
        }

        // ==================== 為所有面板添加點擊切換事件 ====================
        function setupPanelClickHandlers(containerSelector) {
            document.querySelectorAll(containerSelector + ' .pachinko-panel').forEach(panel => {
                // 移除原有的事件監聽器（避免重複）
                panel.removeEventListener('click', panel.clickHandler);
                
                // 定義新的點擊處理函數
                panel.clickHandler = function(e) {
                    e.stopPropagation();
                    
                    const panelId = this.id;
                    const currentPage = parseInt(this.dataset.page);
                    const nextPage = currentPage === 1 ? 2 : 1;
                    
                    const page1 = document.getElementById(`${panelId}-page1`);
                    const page2 = document.getElementById(`${panelId}-page2`);
                    
                    if (page1 && page2) {
                        page1.classList.toggle('hidden');
                        page2.classList.toggle('hidden');
                    }
                    
                    this.dataset.page = nextPage;
                    
                    const dots = this.querySelectorAll('.indicator-dot');
                    dots.forEach((dot, index) => {
                        if (index + 1 === nextPage) {
                            dot.classList.add('active');
                        } else {
                            dot.classList.remove('active');
                        }
                    });
                };
                
                // 添加事件監聽器
                panel.addEventListener('click', panel.clickHandler);
            });
        }

        // ==================== 渲染我的最愛 ====================
        function renderFavoriteList() {
            const container = document.getElementById('favoriteContainer');
            const noMsg = document.getElementById('noFavoriteMsg');
            const countSpan = document.getElementById('favoriteCount');
            
            if (favoriteMachines.length === 0) {
                container.innerHTML = '';
                noMsg.classList.remove('hidden');
                countSpan.textContent = '0 台';
                return;
            }
            
            noMsg.classList.add('hidden');
            countSpan.textContent = favoriteMachines.length + ' 台';
            
            let html = '';
            favoriteMachines.forEach(machine => {
                const isFavorite = favoriteMachines.some(m => m.id === machine.id);
                html += `
                    <div class="horizontal-card" data-id="${machine.id}">
                        <div class="card-top">
                            <img src="${machine.image}" class="card-image">
                            <div class="card-info">
                                <div class="card-name">${machine.name}</div>
                                <div class="info-tags">
                                    <span class="token-badge">${machine.ratio}</span>
                                    <span class="info-tag">${machine.vendor}</span>
                                </div>
                                <div class="card-stats-mini">
                                    <span><i class="fa fa-users"></i> ${Math.floor(Math.random()*8)+1}人</span>
                                    <span><i class="fa fa-trophy"></i> 最大${Math.floor(Math.random()*4000)+2000}</span>
                                </div>
                            </div>
                        </div>
                        
                        ${createPachinkoPanel(machine.id)}
                        
                        <div class="card-actions">
                            <button class="enter-btn available" onclick="handleEnter('${machine.name}')">進入</button>
                            <button class="favorite-btn ${isFavorite ? 'active' : 'inactive'}" onclick="toggleFavorite(${machine.id})">
                                <i class="fa ${isFavorite ? 'fa-heart' : 'fa-heart-o'}"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // 為我的最愛面板添加點擊切換事件
            setupPanelClickHandlers('#favorite-section');
        }

        // ==================== 渲染保留中機台 ====================
        function renderReserveList() {
            const container = document.getElementById('reserveContainer');
            const noMsg = document.getElementById('noReserveMsg');
            const countSpan = document.getElementById('reserveCount');
            
            if (reserveMachines.length === 0) {
                container.innerHTML = '';
                noMsg.classList.remove('hidden');
                countSpan.textContent = '0 台';
                return;
            }
            
            noMsg.classList.add('hidden');
            countSpan.textContent = reserveMachines.length + ' 台';
            
            let html = '';
            reserveMachines.forEach((machine) => {
                const isFavorite = favoriteMachines.some(m => m.id === machine.id);
                
                // 計算剩餘秒數
                const now = Date.now();
                const remainingMs = machine.expiresAt - now;
                const remainingSeconds = Math.max(0, Math.floor(remainingMs / 1000));
                
                // 格式化顯示時間
                const minutes = Math.floor(remainingSeconds / 60);
                const seconds = remainingSeconds % 60;
                const timeDisplay = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // 判斷是否進入最後10分鐘（低於600秒）
                const isLastTenMinutes = remainingSeconds <= 600 && remainingSeconds > 0;
                const timeClass = isLastTenMinutes ? 'countdown-timer urgent' : 'countdown-timer';
                
                html += `
                    <div class="horizontal-card" data-id="${machine.id}" data-expires="${machine.expiresAt}">
                        <div class="card-top">
                            <img src="${machine.image}" class="card-image">
                            <div class="card-info">
                                <div class="card-name">${machine.name}</div>
                                <div class="info-tags">
                                    <span class="token-badge">${machine.ratio}</span>
                                    <span class="info-tag">${machine.vendor}</span>
                                    <span class="info-tag" style="background:#f59e0b; color:black;">
                                        <i class="fa fa-clock-o"></i> 保留 ${machine.reserveTime}
                                    </span>
                                </div>
                                <div class="card-stats-mini">
                                    <span><i class="fa fa-hourglass-half"></i> 剩餘 <span class="${timeClass}">${timeDisplay}</span></span>
                                </div>
                            </div>
                        </div>
                        
                        ${createPachinkoPanel(machine.id)}
                        
                        <div class="card-actions">
                            <button class="enter-btn reserved" onclick="handleEnter('${machine.name} (保留中)')">進入</button>
                            <button class="leave-btn" onclick="showLeaveConfirm(${machine.id}, '${machine.name}')">離開</button>
                            <button class="favorite-btn ${isFavorite ? 'active' : 'inactive'}" onclick="toggleFavorite(${machine.id})">
                                <i class="fa ${isFavorite ? 'fa-heart' : 'fa-heart-o'}"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            
            // 為保留中面板添加點擊切換事件 - 同樣可以點擊切換！
            setupPanelClickHandlers('#reserve-section');
        }

        // ==================== 炫光 Loading 動畫 ====================
        const hologramLoading = document.getElementById('hologramLoading');

        function showHologramLoading() {
            hologramLoading.classList.add('show');
        }

        function hideHologramLoading() {
            hologramLoading.classList.remove('show');
        }

        // ==================== 處理進入按鈕 ====================
        window.handleEnter = function(machineName) {
            // 顯示炫光 loading
            showHologramLoading();
            
            // 模擬載入時間（2 秒後關閉並顯示提示）
            setTimeout(() => {
                hideHologramLoading();
                alert(`🎮 進入遊戲 - ${machineName}\n\n此為演示功能，實際遊玩請前往遊戲頁面。`);
            }, 2000);
        };

        // ==================== 顯示離開確認視窗 ====================
        function showLeaveConfirm(machineId, machineName) {
            const confirmContainer = document.getElementById('confirmContainer');
            
            const machine = reserveMachines.find(m => m.id === machineId);
            const remainingMs = machine.expiresAt - Date.now();
            const remainingMinutes = Math.floor(remainingMs / 60000);
            const remainingSeconds = Math.floor((remainingMs % 60000) / 1000);
            
            const confirmDialog = document.createElement('div');
            confirmDialog.className = 'confirm-dialog';
            confirmDialog.id = `confirm-${machineId}`;
            confirmDialog.innerHTML = `
                <div class="confirm-content">
                    <div class="icon">
                        <i class="fa fa-exclamation-triangle"></i>
                    </div>
                    <h3>離開保留</h3>
                    <div class="machine-name">${machineName}</div>
                    <p>
                        目前剩餘 <span style="color:#ffd700; font-weight:700;">${remainingMinutes}分${remainingSeconds}秒</span><br>
                        確定要離開保留嗎？
                    </p>
                    <div class="confirm-buttons">
                        <button class="confirm-btn cancel" onclick="closeLeaveConfirm(${machineId})">
                            <i class="fa fa-times mr-2"></i>取消
                        </button>
                        <button class="confirm-btn confirm" onclick="confirmLeave(${machineId})">
                            <i class="fa fa-check mr-2"></i>確定離開
                        </button>
                    </div>
                </div>
            `;
            
            confirmContainer.appendChild(confirmDialog);
        }

        // ==================== 關閉離開確認視窗 ====================
        window.closeLeaveConfirm = function(machineId) {
            const confirmDialog = document.getElementById(`confirm-${machineId}`);
            if (confirmDialog) {
                confirmDialog.remove();
            }
        };

        // ==================== 確認離開 ====================
        window.confirmLeave = function(id) {
            const index = reserveMachines.findIndex(m => m.id === id);
            if (index !== -1) {
                reserveMachines.splice(index, 1);
                renderReserveList();
                showMessage('已離開保留');
            }
            closeLeaveConfirm(id);
        };

        // ==================== 檢查最後10分鐘並顯示警示 ====================
        function checkLastTenMinutesAndShowAlerts() {
            const now = Date.now();
            const twoMinutes = 2 * 60 * 1000;
            const tenMinutes = 10 * 60 * 1000;
            
            reserveMachines.forEach(machine => {
                const remainingMs = machine.expiresAt - now;
                
                if (remainingMs <= 0) return;
                
                const isLastTenMinutes = remainingMs <= tenMinutes;
                
                if (isLastTenMinutes && (now - machine.lastAlertTime) >= twoMinutes) {
                    machine.lastAlertTime = now;
                    
                    const remainingMinutes = Math.floor(remainingMs / 60000);
                    const remainingSeconds = Math.floor((remainingMs % 60000) / 1000);
                    
                    showAlertPopup(
                        machine.name, 
                        `${remainingMinutes}分${remainingSeconds}秒`,
                        machine.id
                    );
                }
            });
        }

        // ==================== 顯示彈跳紅色警示小視窗 ====================
        function showAlertPopup(machineName, remainingTime, machineId) {
            const alertContainer = document.getElementById('alertContainer');
            
            const existingAlert = document.querySelector(`.alert-popup[data-machine-id="${machineId}"]`);
            if (existingAlert) return;
            
            const alertDiv = document.createElement('div');
            alertDiv.className = 'alert-popup';
            alertDiv.setAttribute('data-machine-id', machineId);
            alertDiv.innerHTML = `
                <div class="alert-icon">
                    <i class="fa fa-exclamation-triangle"></i>
                </div>
                <div class="alert-content">
                    <div class="alert-title">⏰ 保留即將到期</div>
                    <div class="alert-message">${machineName} 剩餘 ${remainingTime}</div>
                </div>
            `;
            
            alertContainer.appendChild(alertDiv);
            
            setupEnhancedSwipeToDismiss(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                    if (document.querySelectorAll('.alert-popup').length === 0) {
                        document.body.classList.remove('alert-active');
                    }
                }
            }, 30000);
        }

        // ==================== 強化滑動關閉功能 ====================
        function setupEnhancedSwipeToDismiss(alertElement) {
            let startY = 0;
            let currentY = 0;
            let isSwiping = false;
            
            function handleStart(clientY) {
                startY = clientY;
                isSwiping = true;
                alertElement.classList.add('swiping');
                alertElement.style.transition = 'none';
                document.body.classList.add('alert-active');
            }
            
            function handleMove(clientY) {
                if (!isSwiping) return;
                
                currentY = clientY;
                const diffY = currentY - startY;
                
                if (diffY < 0) {
                    const translateY = Math.max(diffY, -200);
                    alertElement.style.transform = `translateX(-50%) translateY(${translateY}px)`;
                    alertElement.style.opacity = 1 + (translateY / 200);
                }
            }
            
            function handleEnd() {
                if (!isSwiping) return;
                
                isSwiping = false;
                alertElement.classList.remove('swiping');
                document.body.classList.remove('alert-active');
                
                const diffY = currentY - startY;
                
                if (diffY < -80) {
                    alertElement.style.transition = 'all 0.3s ease';
                    alertElement.style.transform = `translateX(-50%) translateY(-200px)`;
                    alertElement.style.opacity = '0';
                    
                    setTimeout(() => {
                        if (alertElement.parentNode) {
                            alertElement.remove();
                        }
                    }, 300);
                } else {
                    alertElement.style.transition = 'all 0.3s ease';
                    alertElement.style.transform = 'translateX(-50%) translateY(0)';
                    alertElement.style.opacity = '1';
                }
                
                window.removeEventListener('mousemove', mouseMoveHandler);
                window.removeEventListener('mouseup', mouseUpHandler);
                window.removeEventListener('touchmove', touchMoveHandler);
                window.removeEventListener('touchend', touchEndHandler);
            }
            
            const touchStartHandler = (e) => {
                e.preventDefault();
                handleStart(e.touches[0].clientY);
            };
            
            const touchMoveHandler = (e) => {
                e.preventDefault();
                handleMove(e.touches[0].clientY);
            };
            
            const touchEndHandler = (e) => {
                e.preventDefault();
                handleEnd();
            };
            
            const mouseDownHandler = (e) => {
                e.preventDefault();
                handleStart(e.clientY);
                window.addEventListener('mousemove', mouseMoveHandler);
                window.addEventListener('mouseup', mouseUpHandler);
            };
            
            const mouseMoveHandler = (e) => {
                e.preventDefault();
                handleMove(e.clientY);
            };
            
            const mouseUpHandler = (e) => {
                e.preventDefault();
                handleEnd();
            };
            
            alertElement.addEventListener('touchstart', touchStartHandler, { passive: false });
            alertElement.addEventListener('touchmove', touchMoveHandler, { passive: false });
            alertElement.addEventListener('touchend', touchEndHandler, { passive: false });
            alertElement.addEventListener('touchcancel', touchEndHandler, { passive: false });
            alertElement.addEventListener('mousedown', mouseDownHandler);
            
            window.addEventListener('mouseleave', () => {
                if (isSwiping) {
                    handleEnd();
                }
            });
        }

        // ==================== 顯示提示訊息 ====================
        function showMessage(text) {
            const msgDiv = document.createElement('div');
            msgDiv.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gray-900 text-white px-6 py-3 rounded-lg border-2 border-yellow-400 shadow-2xl z-50';
            msgDiv.style.background = 'linear-gradient(135deg, #000, #333)';
            msgDiv.innerHTML = `<i class="fa fa-check-circle text-yellow-400 mr-2"></i>${text}`;
            document.body.appendChild(msgDiv);
            
            setTimeout(() => {
                msgDiv.remove();
            }, 1500);
        }

        // ==================== 最愛切換 ====================
        window.toggleFavorite = function(id) {
            const machine = machineDatabase.find(m => m.id === id);
            if (!machine) return;
            
            const index = favoriteMachines.findIndex(m => m.id === id);
            if (index !== -1) {
                favoriteMachines.splice(index, 1);
                showMessage('已從我的最愛移除');
            } else {
                favoriteMachines.push(machine);
                showMessage('已加入我的最愛');
            }
            
            // 儲存到 localStorage
            saveFavoritesToStorage(favoriteMachines);
            
            renderFavoriteList();
            renderReserveList();
        };

        // ==================== 更新倒數計時器顯示 ====================
        function updateCountdownDisplay() {
            const countdownElements = document.querySelectorAll('.countdown-timer');
            
            countdownElements.forEach(el => {
                const card = el.closest('.horizontal-card');
                if (!card) return;
                
                const machineId = parseInt(card.dataset.id);
                const machine = reserveMachines.find(m => m.id === machineId);
                if (!machine) return;
                
                const now = Date.now();
                const remainingMs = machine.expiresAt - now;
                
                if (remainingMs <= 0) {
                    el.textContent = '0:00';
                    el.classList.remove('urgent');
                } else {
                    const minutes = Math.floor(remainingMs / 60000);
                    const seconds = Math.floor((remainingMs % 60000) / 1000);
                    el.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    
                    if (remainingMs <= 600000) {
                        el.classList.add('urgent');
                    } else {
                        el.classList.remove('urgent');
                    }
                }
            });
        }

        // ==================== 標籤切換 ====================
        document.querySelectorAll('.category-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');
                
                const target = this.dataset.tab;
                document.querySelectorAll('.category-section').forEach(s => s.classList.add('hidden'));
                document.getElementById(target + '-section').classList.remove('hidden');
            });
        });

        // ==================== 初始化 ====================
        renderFavoriteList();
        renderReserveList();
        
        setInterval(updateCountdownDisplay, 1000);
        setInterval(checkLastTenMinutesAndShowAlerts, 2 * 60 * 1000);
        setTimeout(checkLastTenMinutesAndShowAlerts, 1000);
        
        setInterval(() => {
            renderFavoriteList();
            renderReserveList();
        }, 10000);
        
        // ==================== 監聽其他頁面的最愛變更 ====================
        window.addEventListener('storage', function(e) {
            if (e.key === FAVORITE_STORAGE_KEY) {
                // 重新讀取最愛並更新畫面
                favoriteMachines = loadFavoritesFromStorage();
                renderFavoriteList();
                renderReserveList();
            }
        });
    </script>
</div>
</body>
</html>
